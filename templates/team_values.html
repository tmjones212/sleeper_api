<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ league_name }} - Team Values</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .team-container {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .team-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #27ae60;
        }
        .team-age {
            font-size: 1.1em;
            color: #7f8c8d;
        }
        .team-starter-value {
            font-size: 1.1em;
            color: #2980b9;
        }
        .player-table {
            width: 100%;
        }
        .player-value {
            text-align: right;
            font-weight: bold;
        }
        .summary-section {
            margin-bottom: 40px;
        }
        .position-value-high {
            background-color: #d4edda;
        }
        .position-value-medium {
            background-color: #fff3cd;
        }
        .position-value-low {
            background-color: #f8d7da;
        }
        .numeric {
            text-align: right;
        }
        .young-team {
            color: #27ae60;
        }
        .old-team {
            color: #e74c3c;
        }
        .high-starter-value {
            color: #2980b9;
            font-weight: bold;
        }
        .starter-row {
            background-color: #e8f4f8;
            font-weight: bold;
        }
        .starter-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #2980b9;
        }
        .starter-table {
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 0 5px 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        select {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: #fff;
            width: 100%;
            max-width: 300px;
        }
        .player-select {
            width: 100%;
        }
        .recalculate-btn {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .recalculate-btn:hover {
            background-color: #3498db;
        }
        .value-change {
            font-size: 0.9em;
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            display: none;
        }
        .value-increase {
            background-color: #d4edda;
            color: #155724;
        }
        .value-decrease {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
    <script>
        function openTab(evt, tabName) {
            // Hide all tab content
            var tabcontent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove "active" class from all tabs
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            // Show the current tab and add "active" class to the button that opened the tab
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // Set the first tab as active when the page loads
        window.onload = function() {
            document.getElementsByClassName("tab")[0].click();
        };
        
        function updateStarterValue(teamContainer) {
            const starterTable = teamContainer.querySelector('.starter-table');
            const rows = starterTable.querySelectorAll('tbody tr');
            
            let totalValue = 0;
            let playerCount = 0;
            
            rows.forEach(row => {
                const select = row.querySelector('select');
                const valueCell = row.querySelector('.player-value');
                
                if (select && valueCell) {
                    const selectedOption = select.options[select.selectedIndex];
                    const value = parseInt(selectedOption.getAttribute('data-value') || 0);
                    
                    valueCell.textContent = value;
                    totalValue += value;
                    playerCount++;
                }
            });
            
            const avgStarterValue = playerCount > 0 ? Math.round(totalValue / playerCount * 10) / 10 : 0;
            
            // Update the displayed values
            const currentAvgSpan = teamContainer.querySelector('[id^="current-avg-"]');
            const originalAvgSpan = teamContainer.querySelector('[id^="original-avg-"]');
            const valueChangeDiv = teamContainer.querySelector('[id^="value-change-"]');
            
            const originalValue = parseFloat(originalAvgSpan.textContent);
            currentAvgSpan.textContent = avgStarterValue;
            
            // Show value change notification
            if (avgStarterValue > originalValue) {
                valueChangeDiv.textContent = `Value increased by ${(avgStarterValue - originalValue).toFixed(1)}`;
                valueChangeDiv.className = 'value-change value-increase';
            } else if (avgStarterValue < originalValue) {
                valueChangeDiv.textContent = `Value decreased by ${(originalValue - avgStarterValue).toFixed(1)}`;
                valueChangeDiv.className = 'value-change value-decrease';
            } else {
                valueChangeDiv.textContent = 'Value unchanged';
                valueChangeDiv.className = 'value-change';
            }
            valueChangeDiv.style.display = 'block';
        }
    </script>
</head>
<body>
    <h1>{{ league_name }} - Team Values</h1>
    
    <div class="summary-section">
        <h2>Team Value Summary</h2>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Team</th>
                    <th class="numeric">QB Value</th>
                    <th class="numeric">RB Value</th>
                    <th class="numeric">WR Value</th>
                    <th class="numeric">TE Value</th>
                    <th class="numeric">Total Value</th>
                    <th class="numeric">Avg Starter</th>
                    <th class="numeric">Avg Age</th>
                </tr>
            </thead>
            <tbody>
                {% for team in teams %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ team.team_name }}</td>
                    <td class="numeric">{{ team.position_values.QB }}</td>
                    <td class="numeric">{{ team.position_values.RB }}</td>
                    <td class="numeric">{{ team.position_values.WR }}</td>
                    <td class="numeric">{{ team.position_values.TE }}</td>
                    <td class="numeric player-value">{{ team.total_value }}</td>
                    <td class="numeric high-starter-value">{{ team.avg_starter_value }}</td>
                    <td class="numeric {% if team.avg_age < 25 %}young-team{% elif team.avg_age > 28 %}old-team{% endif %}">
                        {{ team.avg_age }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <h2>Team Details</h2>
    
    {% for team in teams %}
    <div class="team-container" data-team-index="{{ loop.index }}">
        <div class="team-header">
            <h3>{{ loop.index }}. {{ team.team_name }}</h3>
            <div>
                <div class="team-value">Total Value: {{ team.total_value }}</div>
                <div class="team-starter-value">
                    Avg Starter Value: <span id="current-avg-{{ loop.index }}">{{ team.avg_starter_value }}</span>
                    <span id="original-avg-{{ loop.index }}" style="display: none;">{{ team.avg_starter_value }}</span>
                </div>
                <div class="team-age">Average Age: {{ team.avg_age }}</div>
                <div id="value-change-{{ loop.index }}" class="value-change"></div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab" onclick="openTab(event, 'starters-{{ loop.index }}')">Starting Lineup</button>
            <button class="tab" onclick="openTab(event, 'roster-{{ loop.index }}')">Full Roster</button>
        </div>
        
        <div id="starters-{{ loop.index }}" class="tab-content">
            <div class="starter-section">
                <h4>Starting Lineup</h4>
                <table class="starter-table">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Player</th>
                            <th class="numeric">Age</th>
                            <th class="numeric">KTC Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for starter in team.starters %}
                        <tr>
                            <td>{{ starter.starter_position }}</td>
                            <td class="player-select">
                                <select onchange="this.closest('.team-container').querySelector('.recalculate-btn').click()">
                                    {% if starter.starter_position == 'QB' or starter.starter_position == 'SUPER_FLEX' %}
                                        {% for player in team.players if player.position == 'QB' %}
                                            <option value="{{ player.name }}" data-value="{{ player.ktc_value }}" {% if player.name == starter.name %}selected{% endif %}>
                                                {{ player.name }} ({{ player.position }}) - {{ player.ktc_value }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                    
                                    {% if starter.starter_position == 'RB' or starter.starter_position == 'FLEX' or starter.starter_position == 'SUPER_FLEX' %}
                                        {% for player in team.players if player.position == 'RB' %}
                                            <option value="{{ player.name }}" data-value="{{ player.ktc_value }}" {% if player.name == starter.name %}selected{% endif %}>
                                                {{ player.name }} ({{ player.position }}) - {{ player.ktc_value }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                    
                                    {% if starter.starter_position == 'WR' or starter.starter_position == 'FLEX' or starter.starter_position == 'SUPER_FLEX' %}
                                        {% for player in team.players if player.position == 'WR' %}
                                            <option value="{{ player.name }}" data-value="{{ player.ktc_value }}" {% if player.name == starter.name %}selected{% endif %}>
                                                {{ player.name }} ({{ player.position }}) - {{ player.ktc_value }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                    
                                    {% if starter.starter_position == 'TE' or starter.starter_position == 'FLEX' or starter.starter_position == 'SUPER_FLEX' %}
                                        {% for player in team.players if player.position == 'TE' %}
                                            <option value="{{ player.name }}" data-value="{{ player.ktc_value }}" {% if player.name == starter.name %}selected{% endif %}>
                                                {{ player.name }} ({{ player.position }}) - {{ player.ktc_value }}
                                            </option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </td>
                            <td class="numeric">{{ starter.age }}</td>
                            <td class="numeric player-value">{{ starter.ktc_value }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <button class="recalculate-btn" onclick="updateStarterValue(this.closest('.team-container'))">Recalculate Starter Value</button>
            </div>
        </div>
        
        <div id="roster-{{ loop.index }}" class="tab-content">
            <table class="player-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Position</th>
                        <th class="numeric">Age</th>
                        <th class="numeric">KTC Value</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player in team.players %}
                    <tr {% if player.is_starter %}class="starter-row"{% endif %}>
                        <td>{{ player.name }} {% if player.is_starter %}({{ player.starter_position }}){% endif %}</td>
                        <td>{{ player.position }}</td>
                        <td class="numeric">{{ player.age }}</td>
                        <td class="numeric player-value">{{ player.ktc_value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
    
    <div class="footer">
        <p>Values sourced from KeepTradeCut.com</p>
        <p>Report generated: {{ generated_date }}</p>
    </div>
</body>
</html> 